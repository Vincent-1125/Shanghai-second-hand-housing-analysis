<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=gh9u1qMjV72Wgif2b5mSWxabPMW1IhW7"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:800px;width:100%;}
		#r-result{width:100%;}
    </style>	
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="显示热力图"/><input type="button"  onclick="closeHeatmap();" value="关闭热力图"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(121.2, 31.3);
    map.centerAndZoom(point, 13);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放
  
    var points =[{'lat': 31.30071534, 'lng': 121.1695305, 'count': 23980.0}, {'lat': 31.29814384, 'lng': 121.161959, 'count': 33593.0}, {'lat': 31.31044207, 'lng': 121.1564009, 'count': 31167.66667}, {'lat': 31.42175971, 'lng': 121.3884008, 'count': 37041.0}, {'lat': 31.36155645, 'lng': 121.2652564, 'count': 49680.66667}, {'lat': 31.36002086, 'lng': 121.266234, 'count': 50881.0}, {'lat': 31.358128, 'lng': 121.261617, 'count': 55590.0}, {'lat': 31.30587688, 'lng': 121.1588092, 'count': 28391.0}, {'lat': 31.308045, 'lng': 121.1576301, 'count': 28457.0}, {'lat': 31.26573365, 'lng': 121.343188, 'count': 50573.0}, {'lat': 31.81999828, 'lng': 119.9886758, 'count': 49027.0}, {'lat': 31.38286962, 'lng': 121.2603219, 'count': 27610.0}, {'lat': 0.0, 'lng': 0.0, 'count': 27356.0}, {'lat': 31.29550315, 'lng': 121.1626687, 'count': 34882.0}, {'lat': 31.32104789, 'lng': 121.400386, 'count': 36851.0}, {'lat': 31.24998777, 'lng': 121.3323533, 'count': 50826.33333}, {'lat': 31.27739289, 'lng': 121.2139459, 'count': 22482.0}, {'lat': 31.30095131, 'lng': 121.3145687, 'count': 40796.0}, {'lat': 31.30351872, 'lng': 121.3145198, 'count': 43274.75}, {'lat': 31.30207388, 'lng': 121.319991, 'count': 43804.0}, {'lat': 31.29974085, 'lng': 121.315362, 'count': 32390.0}, {'lat': 31.39444642, 'lng': 121.2625985, 'count': 29946.0}, {'lat': 31.214466, 'lng': 121.3777721, 'count': 23184.0}, {'lat': 31.25133485, 'lng': 121.371066, 'count': 52517.83333}, {'lat': 31.25340329, 'lng': 121.3649276, 'count': 53880.5}, {'lat': 31.25434917, 'lng': 121.3619003, 'count': 54489.0}, {'lat': 31.25374773, 'lng': 121.3762031, 'count': 51151.0}, {'lat': 31.25425085, 'lng': 121.373019, 'count': 51400.66667}, {'lat': 31.29679311, 'lng': 121.1664195, 'count': 26062.0}, {'lat': 30.89898261, 'lng': 121.0154517, 'count': 26629.5}, {'lat': 31.3671035, 'lng': 121.182397, 'count': 24159.0}, {'lat': 31.26717589, 'lng': 121.328861, 'count': 46631.0}, {'lat': 31.34529289, 'lng': 121.285772, 'count': 52295.0}, {'lat': 31.32473675, 'lng': 121.2840359, 'count': 57657.66667}, {'lat': 31.38695817, 'lng': 121.2285661, 'count': 39805.66667}, {'lat': 31.29916686, 'lng': 121.3183252, 'count': 42817.0}, {'lat': 31.36088934, 'lng': 121.1825337, 'count': 25928.33333}, {'lat': 31.2680345, 'lng': 121.359825, 'count': 39932.0}, {'lat': 31.22119985, 'lng': 121.370462, 'count': 28888.42857}, {'lat': 31.2936899, 'lng': 121.31008, 'count': 41465.0}, {'lat': 31.31582642, 'lng': 121.3288753, 'count': 48354.88889}, {'lat': 31.30507522, 'lng': 121.3119512, 'count': nan}, {'lat': 31.38415992, 'lng': 121.2855036, 'count': 32446.0}, {'lat': 31.27039047, 'lng': 121.3473844, 'count': 47811.16667}, {'lat': 31.31779279, 'lng': 121.3223271, 'count': 73607.30769}, {'lat': 31.2542172, 'lng': 121.3692569, 'count': 56930.0}, {'lat': 31.26255387, 'lng': 121.334502, 'count': 52344.0}, {'lat': 31.28944151, 'lng': 121.3258918, 'count': 68241.5}, {'lat': 31.34297806, 'lng': 121.2542865, 'count': 49821.0}, {'lat': 31.38419992, 'lng': 121.239425, 'count': 44813.0}, {'lat': 31.30312456, 'lng': 121.3192567, 'count': 46403.0}, {'lat': 31.30403892, 'lng': 121.3189682, 'count': 49555.0}, {'lat': 31.33999089, 'lng': 121.287619, 'count': 44428.0}, {'lat': 31.27300741, 'lng': 121.351615, 'count': 51575.0}, {'lat': 31.38694098, 'lng': 121.2537783, 'count': 27860.0}, {'lat': 31.26896827, 'lng': 121.3565559, 'count': 79144.0}, {'lat': 31.27192785, 'lng': 121.356998, 'count': 51956.7}, {'lat': 31.27431482, 'lng': 121.3514902, 'count': 51594.33333}, {'lat': 31.25896002, 'lng': 121.3843357, 'count': 55813.0}, {'lat': 31.37805371, 'lng': 121.2426687, 'count': 29142.0}, {'lat': 31.40150756, 'lng': 121.2623187, 'count': 29815.25}, {'lat': 31.2602481, 'lng': 121.377965, 'count': 58514.0}, {'lat': 31.26103987, 'lng': 121.386413, 'count': 56033.5}, {'lat': 31.26138822, 'lng': 121.3822476, 'count': 56205.0}, {'lat': 31.25918837, 'lng': 121.3812823, 'count': 53532.5}, {'lat': 31.27067196, 'lng': 121.3539429, 'count': 51327.33333}, {'lat': 31.29329863, 'lng': 121.2269701, 'count': 33149.4}, {'lat': 31.25281791, 'lng': 121.378827, 'count': 59122.0}, {'lat': 31.29309991, 'lng': 121.1669928, 'count': 37663.0}, {'lat': 31.26256452, 'lng': 121.3313016, 'count': 49813.0}, {'lat': 31.39353116, 'lng': 121.2773746, 'count': 28937.0}, {'lat': 31.26069299, 'lng': 121.3758477, 'count': 56440.33333}, {'lat': 31.26138305, 'lng': 121.3735428, 'count': 58372.25}, {'lat': 31.26740484, 'lng': 121.355798, 'count': 50196.0}, {'lat': 31.26149517, 'lng': 121.353151, 'count': 45201.9}, {'lat': 31.2603897, 'lng': 121.343496, 'count': 44840.0}, {'lat': 31.26090863, 'lng': 121.3454492, 'count': 46847.33333}, {'lat': 31.26015997, 'lng': 121.3433762, 'count': 47948.33333}, {'lat': 31.26251243, 'lng': 121.3427259, 'count': 45360.4}, {'lat': 31.26251243, 'lng': 121.3427259, 'count': 47327.0}, {'lat': 31.26490179, 'lng': 121.3512775, 'count': 49507.33333}, {'lat': 31.31505277, 'lng': 121.3254167, 'count': 53017.0}, {'lat': 31.38147935, 'lng': 121.2451704, 'count': 34739.0}, {'lat': 31.27607782, 'lng': 121.3116039, 'count': 47352.11111}, {'lat': 31.26504378, 'lng': 121.3694241, 'count': 63246.5}, {'lat': 31.26623392, 'lng': 121.3666538, 'count': 66608.0}, {'lat': 31.24562308, 'lng': 121.3679419, 'count': 56871.81818}, {'lat': 31.25212686, 'lng': 121.314809, 'count': 50981.83333}, {'lat': 31.25380585, 'lng': 121.319776, 'count': 52128.0}, {'lat': 30.99407936, 'lng': 121.5066231, 'count': 31287.0}, {'lat': 31.25386736, 'lng': 121.3140867, 'count': 48473.66667}, {'lat': 31.25120496, 'lng': 121.3589112, 'count': 64792.5}, {'lat': 31.39190647, 'lng': 121.2619579, 'count': 32559.0}, {'lat': 31.25188768, 'lng': 121.3238671, 'count': 53413.0}, {'lat': 31.25097891, 'lng': 121.378277, 'count': 55845.0}, {'lat': 31.33213114, 'lng': 121.264078, 'count': 51155.0}, {'lat': 31.28289581, 'lng': 121.2224608, 'count': 26977.0}, {'lat': 31.25424883, 'lng': 121.3811902, 'count': 64886.0}, {'lat': 31.29938062, 'lng': 121.3217239, 'count': 47929.0}, {'lat': 31.37414422, 'lng': 121.2599592, 'count': 26653.0}, {'lat': 31.25203911, 'lng': 121.3676009, 'count': 51971.0}, {'lat': 31.38679471, 'lng': 121.2774715, 'count': 28844.5}, {'lat': 31.29430913, 'lng': 121.3139815, 'count': 41068.0}, {'lat': 31.31190004, 'lng': 121.3090808, 'count': 55747.0}, {'lat': 31.37370734, 'lng': 121.2521036, 'count': 27740.0}, {'lat': 31.37758934, 'lng': 121.2540841, 'count': 27472.5}, {'lat': 31.37113323, 'lng': 121.2543087, 'count': 27579.5}, {'lat': 31.37275605, 'lng': 121.2571819, 'count': 28281.0}, {'lat': 31.37177322, 'lng': 121.2551804, 'count': 26185.0}, {'lat': 31.37497788, 'lng': 121.253321, 'count': 27448.0}, {'lat': 31.3746816, 'lng': 121.2574918, 'count': 24620.0}, {'lat': 31.37660472, 'lng': 121.2601636, 'count': 28589.5}, {'lat': 31.37848625, 'lng': 121.2563224, 'count': 26803.0}, {'lat': 31.34510376, 'lng': 121.2528887, 'count': 53950.0}, {'lat': 0.0, 'lng': 0.0, 'count': 53115.0}, {'lat': 31.31461585, 'lng': 121.1604912, 'count': 27538.5}, {'lat': 31.31400871, 'lng': 121.167389, 'count': 28473.0}, {'lat': 31.375118, 'lng': 121.2448159, 'count': 30365.0}, {'lat': 31.39714186, 'lng': 121.245113, 'count': 45415.875}, {'lat': 31.38401719, 'lng': 121.2510347, 'count': 26163.5}, {'lat': 31.3153558, 'lng': 121.321683, 'count': 56305.0}, {'lat': 31.29898844, 'lng': 121.2048218, 'count': 38289.66667}, {'lat': 31.30007587, 'lng': 121.1986192, 'count': 38140.0}, {'lat': 31.35355551, 'lng': 121.1828339, 'count': 28144.66667}, {'lat': 31.29757478, 'lng': 121.3163206, 'count': 39554.0}, {'lat': 31.37727673, 'lng': 121.2315204, 'count': 37814.5}, {'lat': 31.41990293, 'lng': 121.20672, 'count': 32423.5}, {'lat': 31.25494605, 'lng': 121.5953767, 'count': 49396.33333}, {'lat': 31.24614746, 'lng': 121.3152038, 'count': 48811.0}, {'lat': 31.3279114, 'lng': 121.5410948, 'count': 31199.4}, {'lat': 31.39316759, 'lng': 121.2693188, 'count': 22324.0}, {'lat': 31.37876063, 'lng': 121.2474984, 'count': 31173.0}, {'lat': 31.37891948, 'lng': 121.2434678, 'count': 23125.0}, {'lat': 31.38528319, 'lng': 121.2575734, 'count': 30650.16667}, {'lat': 31.25391976, 'lng': 121.3838586, 'count': 67095.0}, {'lat': 31.24762851, 'lng': 121.369113, 'count': 68977.2}, {'lat': 31.27699407, 'lng': 121.3176875, 'count': 49191.0}, {'lat': 31.37113192, 'lng': 121.16214, 'count': 20833.16667}];


	if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小   
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1. 
		    value 为颜色值. 
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"visible":true}, {"radius":3}, {"opacity":30});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:70000});
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	closeHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		
		}*/
     	var gradient = {
			0:'rgb(102, 255, 0)',
	 	 	0.5:'rgb(255, 170, 0)',
		  	0.2:'rgb(255, 0, 0)'
		 };
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value; 
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>